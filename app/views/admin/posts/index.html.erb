<% content_for :head do %>
  <%= stylesheet_link_tag "admin_posts.css", "data-turbo-track": "reload" %>
<% end %>
<!-- Sidebar -->
<%= render 'admin/shared/sidebar'%>
<!-- Main Content -->
<div class="main-content">
  <!-- Top Navbar -->
  <%= render 'admin/shared/topbar'%>
  <!-- Content -->
  <div class="content-wrapper">
    <%= turbo_stream_from "admin_posts" %>
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#" style="color: var(--primary-color); text-decoration: none;">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Posts</li>
      </ol>
    </nav>
    <h1 class="page-title">Posts Management</h1>
    <!-- Filters Card -->
    <div class="card filter-card">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <%= form_with url: admin_posts_index_path, method: :get, local: true, class: "search-form" do %>
              <label class="form-label fw-semibold">Search Posts</label>
              <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                  <i class="fas fa-search text-muted"></i>
                </span>
                <%= text_field_tag :query, params[:query], class: "form-control search-input border-start-0", placeholder: "Search by content or author..." %>
              </div>
            <% end %>
          </div>
          <div class="col-md-2">
            <label class="form-label">&nbsp;</label>
            <div class="d-grid">
              <button class="btn primary-btn">
                <i class="fas fa-filter me-2"></i>Filter
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Posts Table -->
    <div class="card posts-table-card">
      <div class="table-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5><i class="fas fa-file-alt me-2"></i>All Posts <%= @posts.count %></h5>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-outline-danger btn-sm" onclick="submitBulkDeleteForm()">
              <i class="fas fa-trash me-1"></i>Bulk Delete
            </button>
          </div>
        </div>
      </div>
      <%= form_with url: bulk_delete_admin_posts_path, method: :delete, id: "bulk-delete-form", local: true do %>
        <div class="table-responsive">
          <% if !@posts.empty? %>
            <div id="posts-table">
              <%= render "posts_table", posts: @posts %>
            </div>
          <% else %>
            <p class="text-muted p-2">No posts found</p>
          <% end %>
        </div>
      <% end %>
      <!-- Pagination -->
      <div class="pagination-wrapper">
        <div id="pagination">
          <%= render "admin/shared/pagination", posts: @posts %>
        </div>
      </div>
    </div>
  </div>
</div>
<%= content_for :scripts do %>
  <script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('show');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.querySelector('[onclick="toggleSidebar()"]');

        if (window.innerWidth <= 768 &&
            !sidebar.contains(e.target) &&
            !toggleBtn.contains(e.target) &&
            sidebar.classList.contains('show')) {
            sidebar.classList.remove('show');
        }
    });

    function submitBulkDeleteForm() {
      const checkboxes = document.querySelectorAll('.post-checkbox:checked');
      if (checkboxes.length === 0) {
        alert('Please select at least one post to delete.');
        return;
      }
      if (confirm('Are you sure you want to delete the selected posts?')) {
        document.getElementById('bulk-delete-form').submit();
      }
    }
    function toggleAllCheckboxes(source) {
      const checkboxes = document.querySelectorAll('.post-checkbox');
      checkboxes.forEach(cb => cb.checked = source.checked);
    }
  </script>
<% end %>
