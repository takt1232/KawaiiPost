<%= content_for :head do %>
  <%= stylesheet_link_tag "posts_show.css", "data-turbo-track": "reload" %>
<% end %>
<div class="container py-5 animate__animated animate__fadeIn">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="fw-bold brand-font text-primary mb-0">
            <i class="fas fa-newspaper me-2"></i>Post Details
          </h1>
          <nav aria-label="breadcrumb" class="mt-2">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><%= link_to "Home", root_path %></li>
              <li class="breadcrumb-item"><%= link_to "All Posts", posts_path %></li>
              <li class="breadcrumb-item active" aria-current="page"><%= truncate(@post.title, length: 20) %></li>
            </ol>
          </nav>
        </div>
        <div class="btn-group">
          <%= link_to "Back", posts_path, class: "btn btn-outline-secondary btn-hover-scale" %>
          <%= link_to "Edit", edit_post_path(@post), class: "btn btn-primary btn-hover-scale" %>
        </div>
      </div>
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4 p-lg-5">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="card-title fw-bold mb-0"><%= @post.title %></h2>
            <% if @post.published_date %>
              <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3 py-2">
                <i class="fas fa-calendar-day me-1"></i>
                <%= @post.published_date.strftime("%b %d, %Y") %>
              </span>
            <% end %>
          </div>
          <div class="post-meta mb-4 d-flex align-items-center">
            <div class="avatar me-3">
              <i class="fas fa-user-circle fa-2x text-primary"></i>
            </div>
            <div>
              <p class="mb-0 fw-bold">Posted by <%= current_user.email%></p>
              <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                <%= time_ago_in_words(@post.created_at) %> ago
                <% if @post.updated_at > @post.created_at %>
                  <span class="ms-2">
                    <i class="fas fa-sync-alt me-1"></i>
                    Updated <%= time_ago_in_words(@post.updated_at) %> ago
                  </span>
                <% end %>
              </small>
            </div>
          </div>
          <div class="post-content mb-5">
            <%= simple_format(@post.body, {}, wrapper_tag: "div", class: "mb-0") %>
          </div>
          <div class="post-actions d-flex justify-content-between border-top border-bottom py-3 mb-4">
            <button class="btn btn-outline-primary rounded-pill">
              <i class="far fa-comment me-1"></i>
              <span class="comment-count">8</span> Comments
            </button>
          </div>
          <div class="d-flex justify-content-end gap-3">
            <%= link_to "Delete", @post, method: :delete, data: { confirm: "Are you sure you want to delete this post?" }, class: "btn btn-outline-danger btn-hover-scale" %>
            <%= link_to "Edit Post", edit_post_path(@post), class: "btn btn-kawaii btn-hover-scale" %>
          </div>
        </div>
      </div>
      <!-- Comments Section -->
      <div class="card border-0 shadow-sm mb-4 animate__animated animate__fadeInUp">
        <div class="card-header bg-light">
          <h3 class="h5 mb-0"><i class="fas fa-comments me-2"></i>Comments</h3>
        </div>
        <div class="card-body">
          <div class="comment-form mb-4">
            <%= form_with(model: [@post, @comment]) do |f| %>
              <div class="mb-3">
                <%= f.text_area :content, rows: 3, class: "form-control", placeholder: "Add a comment..." %>
              </div>
              <%= f.submit "Post Comment", class: "btn btn-primary" %>
            <% end %>
          </div>
          <div class="comment-list">
            <% @post_comments.each do | comment | %>
              <div class="comment mb-4 pb-3 border-bottom">
                <div class="d-flex mb-2">
                  <div class="avatar me-3">
                    <i class="fas fa-user-circle fa-lg text-primary"></i>
                  </div>
                  <div>
                    <p class="mb-0 fw-bold"><%= comment.user.email %></p>
                    <small class="text-muted"><%= comment.created_at.strftime("%b %d, %Y")%></small>
                  </div>
                </div>
                <div class="comment-body">
                  <p><%= comment.content %></p>
                </div>
                <div class="d-flex justify-content-end">
                  <%= link_to edit_post_comment_path(comment.post, comment), class: "btn btn-outline-secondary" do %>
                    <i class="fas fa-edit me-1"></i> Edit
                  <% end %>
                  <%= link_to post_comment_path(comment.post, comment), 
                        data: { turbo_method: :delete, turbo_confirm: "Delete this comment?" }, 
                        class: "btn btn-outline-danger" do %>
                    <i class="fas fa-trash me-1"></i> Delete
                  <% end %>
                </div>
              </div>
            <% end %>
            <% if @post_comments.empty?%>
              <p class="text-muted">No Comments</p>
            <% end %>
          </div>
        </div>
      </div>
      <!-- Related Posts -->
      <div class="card border-0 shadow-sm animate__animated animate__fadeInUp">
        <div class="card-header bg-light">
          <h3 class="h5 mb-0"><i class="fas fa-layer-group me-2"></i>Related Posts</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-0 shadow-sm-hover">
                <div class="card-body">
                  <h4 class="h6 fw-bold">The Evolution of Shonen Anime</h4>
                  <p class="small text-muted mb-2">Posted 3 days ago</p>
                  <p class="small">Exploring how shonen anime has changed over the decades...</p>
                  <%= link_to "Read More", "#", class: "btn btn-sm btn-outline-primary" %>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-0 shadow-sm-hover">
                <div class="card-body">
                  <h4 class="h6 fw-bold">Top 10 Anime of 2023</h4>
                  <p class="small text-muted mb-2">Posted 1 week ago</p>
                  <p class="small">Our picks for the best anime releases this year...</p>
                  <%= link_to "Read More", "#", class: "btn btn-sm btn-outline-primary" %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<%= content_for :scripts do %><script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize animations when elements come into view
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = 1;
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.animate__animated').forEach(el => {
        observer.observe(el);
      });
    });
  </script>
<% end %>
