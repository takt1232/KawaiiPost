<%= content_for :head do %>
  <%= stylesheet_link_tag "posts_show.css", "data-turbo-track": "reload" %>
<% end %>
<div class="post-show-container">
  <div class="post-show-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-newspaper me-2"></i>Post Details
      </h1>
      <nav class="breadcrumb-nav">
        <ol>
          <li><%= link_to "Home", root_path %></li>
          <li><%= link_to "All Posts", posts_path %></li>
          <li class="active"><%= truncate(@post.title, length: 20) %></li>
        </ol>
      </nav>
    </div>
    <div class="header-actions">
      <%= link_to "Back", posts_path, class: "btn-back" %>
    </div>
  </div>
  <% if notice %>
    <div class="alert alert-success">
      <%= notice %>
    </div>
  <% end %>
  <% if alert %>
    <div class="alert alert-danger">
      <%= alert %>
    </div>
  <% end %>
  <div class="post-card">
    <div class="post-card-content">
      <div class="post-title-section">
        <h2><%= @post.title %></h2>
        <% if @post.published_date %>
          <span class="post-date">
            <i class="fas fa-calendar-day me-1"></i>
            <%= @post.published_date.strftime("%B %e, %Y at %l:%M %p") %>
          </span>
        <% end %>
      </div>
      <div class="post-meta">
        <div class="avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="meta-details">
          <p class="author">Posted by <%= current_user.email %></p>
          <p class="timestamps">
            <i class="fas fa-clock me-1"></i>
            <%= time_ago_in_words(@post.created_at) %> ago
            <% if @post.updated_at > @post.created_at %>
              <span class="updated">
                <i class="fas fa-sync-alt me-1"></i>
                Updated <%= time_ago_in_words(@post.updated_at) %> ago
              </span>
            <% end %>
          </p>
        </div>
      </div>
      <div class="post-body">
        <%= simple_format(@post.body, {}, wrapper_tag: "div") %>
      </div>
      <div class="post-actions">
        <div class="comment-action">
          <button class="btn-comment-count">
            <i class="far fa-comment me-1"></i>
            <span class="count"><%= @post.comments.count %></span> Comments
          </button>
        </div>
        <div class="post-management-actions">
          <% if current_user == @post.user %>
            <%= link_to post_path(@post), 
                          data: { turbo_method: :delete, turbo_confirm: "Delete this post?" }, 
                          class: "btn-action btn-delete" do %>
              <i class="fas fa-trash me-1"></i> Delete
            <% end %>
            <%= link_to "Edit Post", edit_post_path(@post), class: "btn-edit-post" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <!-- Comments Section -->
  <div class="comments-section">
    <div class="section-header">
      <h3><i class="fas fa-comments me-2"></i>Comments</h3>
    </div>
    <div class="comment-form">
      <%= form_with(model: [@post, @comment]) do |f| %>
        <div class="form-group">
          <%= f.text_area :content, rows: 3, placeholder: "Add a comment..." %>
        </div>
        <%= f.submit "Post Comment", class: "btn-submit-comment" %>
      <% end %>
    </div>
    <div class="comment-list">
      <% if @post_comments.any? %>
        <% @post_comments.each do |comment| %>
          <div class="comment">
            <div class="comment-header">
              <div class="comment-avatar">
                <i class="fas fa-user-circle"></i>
              </div>
              <div class="comment-meta">
                <p class="comment-author"><%= comment.user.email %></p>
                <p class="comment-date"><%= comment.created_at.strftime("%B %e, %Y at %l:%M %p") %></p>
              </div>
            </div>
            <div class="comment-body">
              <p><%= comment.content %></p>
            </div>
            <% if current_user == comment.user %>
              <div class="comment-actions">
                <%= link_to edit_post_comment_path(comment.post, comment), class: "btn-edit-comment" do %>
                  <i class="fas fa-edit me-1"></i> Edit
                <% end %>
                <%= link_to post_comment_path(comment.post, comment), 
                          data: { turbo_method: :delete, turbo_confirm: "Delete this comment?" }, 
                          class: "btn-delete-comment" do %>
                  <i class="fas fa-trash me-1"></i> Delete
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <p class="no-comments">No comments yet</p>
      <% end %>
    </div>
  </div>
</div>
